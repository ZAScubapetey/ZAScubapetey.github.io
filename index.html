<!DOCTYPE html>
<html lang="en">

<head>
    <title>Nohire Api Test</title>
    <meta charset="UTF-8">
    <meta name="API" content="Nohire Api Test">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.6/css/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css'>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
   

    <script>
        var xmlhttp;
        var sessionToken;
        window.onload = function () {
            document.getElementById('btnSearch').addEventListener('click', executeSearch, false);
        }

        async function executeSearch() {
            // login
            await systemLogin();
            await searchFunc();
        }

        async function systemLogin(e) {
            var apiNumber = $("#apiNumber").val();
            var apiUsername = $("#apiUsername").val();
            var apiPassword = $("#apiPassword").val();
            var result = await $.ajax({
                url: "https://nohire.dev.nohire.co.za/sec_api_Login/",
                type: "GET",
                data: {
                    "system_token": apiNumber,
                    "username": apiUsername,
                    "password": apiPassword,
                }
            });

            sessionToken = result.session_token;

            var display_result = JSON.stringify(result, null, 4);
            $('#token').val(display_result);
            $("#results").removeClass("invisible");
        }

        async function searchFunc(e) {


            console.log("searchFunc");

            var idNumber = $("#idNumber").val();
            var result = await $.ajax({
                url: "https://nohire.dev.nohire.co.za/search_api/",
                type: "GET",
                data: {
                    "session_token": sessionToken,
                    "id_number": idNumber,
                    "id_number_type": "1",
                }
            });

            var display_result = JSON.stringify(result, null, 4);
            $('#request-result').val(display_result);
            $("#searchResults").removeClass("invisible");
        }
    </script>
</head>

<body>
    <div id="Top" class="jumbotron jumbotron-fluid" style="margin-bottom:0">
        <h1 class="text-center">Nohire Test</h1>
    </div>
    </br>
    <div id="container" class="container-fluid">
        <div class="row">
            <div class="" style="border: 10px;"><input type="text" id="apiUsername" value="Username" /></div>
            <div class=""><input type="text" id="apiPassword" value="password" /></div>
        </div>
        <div class="row">
            <div class="" style="border: 10px;"><input type="text" id="apiNumber" value="API" /></div>
            <div class=""><input type="text" id="idNumber" value="Id Number" /></div>

        </div>
        </br>
        <div class="col-sm-3"><button id="btnSearch" class="btn btn-primary">Get Results</button></div>
        </br>
        <div class="invisible" id="results">
            <div class="row">
                <div class="col-sm-12">
                    <textarea id="token" style="width:50%;height:200px"></textarea>
                </div>
            </div>
        </div>
        </br>
        <div class="invisible" id="searchResults">
            <div class="row">
                <div class="col-sm-12" style="width:50%;height:400px">
                    <textarea id="request-result" style="width:50%;height:400px"></textarea>
                    <div id="matchTrue"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div id="ticketNumber"></div>
                </div>
            </div>
        </div>
    </div> <!-- container -->
</body>

</html>
<!--
Url for api call:
https://www.nohire.co.za/sec_api_Login/
https://www.nohire.co.za/search_api/

Login Request:
{
  "system_token" : "Security token to be used for basic protection in Login Request (Nohire provide during setup)",
  "username" : "Valid username",
  "password" : "password for username"
}

Login Response:
{
  "system_token" : " Security token as provided in Login Request (Default value = "")",
  "session_token" : "Token to be used for further transactions, will expire and after login session timeout (Default value = "")",
  "error_message" : "Error message if any (Default value = "")"
  "error_code" : "Error as code (Default value = "0")"
}

Login call example:
Fill in your values in stead of the placeholder variables for : $system_token, $username, $password

Calling the search using JSON in the body to carry over the values:
curl -X POST https://www.nohire.co.za/sec_api_Login/ -d '{
    "system_token": "$system_token",
    "username": "$username",
    "password": "$password"
}'

Calling the search using the headers to carry over the values:
curl -X POST https://www.nohire.co.za/sec_api_Login/ \
  -H 'system_token: $system_token' \
  -H 'username: $username' \
  -H 'password: $password' 

Calling the search using the url to carry over the values:
curl -X POST 'https://www.nohire.co.za/sec_api_Login/?system_token=$system_token&username=$username&password=$password'

Search Request:
{
  "session_token" : "Valid Token as provided in Login Response",
  "id_number" : "Valid identification number",
  "id_number_type" : "Type of identification ("South African" OR "1", "Malawian" OR "2", "United Kingdom" OR "3", "Zimbabwean" OR "4")"
  "company_name" : "Company name to search on", 
  "contact_numbers" : "10-digit contact telephone number (Only numbers) to search on", 
  "vehicle_registrastion_number" : "Vehicle registration number to search on"
}

Login error code list:
1: Invalid system token was provided during the login attempt.
2: The username you provided was incorrect or does not exsist on the system.
3: The username you are using is marked as inactive.
4: The client the username you enterd belongs to is inactive.
5: The password you have enterd for the username is invalid.
6: Connection error occured while checking if the username you enterd matches a all ready exsisting session token.
7: Connection error occured while checking if the token is still active and belongs to the same IP.
8: Token all ready exist for the current username under a diffrent IP.

Search Response:
{
  "session_token" : "Token provided in Search Request (Default value = "")",
  "match" : "Search result type (none/exact/multiple) (Default value = "none")",
  "ticket_count" : "Number of open tickets 0 = none,  -1= invalid (Default value = "0")",
  "equipment_returned" : "Did the client return the equipment (yes/no) (Default value = "")",
  "contact_details_to_refer_client_to_resolve_tickets": [
     {"id": "unique system id (Default value = "")",
       "company_name" : "1 Name of company that created ticket (Default value = "")", 
       "contact_name" : "2 Contact name of profile that created the Ticket (Default value = "")",
       "contact_numbers" : [ "3 Contact number of profile that created the Ticket (Default value = "")", "3 Contact name of profile that created the Ticket (Default value = "")"], 
       "equipment_returned" : "4 Did the client return the equipment (yes/no) (Default value = "")"
     },
     {"id": "unique system id (Default value = "")",
       "company_name" : "1 Name of company that created ticket (Default value = "")", 
       "contact_name" : "2 Contact name of profile that created the Ticket (Default value = "")",
       "contact_numbers" : [ "3 Contact number of profile that created the Ticket (Default value = "")", "3 Contact name of profile that created the Ticket (Default value = "")"], 
       "equipment_returned" : "4 Did the client return the equipment (yes/no) (Default value = "")"
     }
    ],
  "error_message" : "Error message if any (Default value = "")"
  "error_code" : "Error as code (Default value = "0")"
}

Search call example:
Fill in your values in stead of the placeholder variables for : $your_session_key, $id_number, $id_number_type, $company_name, $contact_phone_number, $vehicle_registrastion_number

Calling the search using JSON in the body to carry over the values:
curl -X POST https://www.nohire.co.za/search_api/ -d '{
    "session_token": "$your_session_key",
    "id_number": "$id_number",
    "id_number_type": "$id_number_type",
    "company_name": "$company_name",
    "contact_phone_number": "$contact_phone_number",
    "vehicle_registrastion_number": "$vehicle_registrastion_number"
}'

Calling the search using the headers to carry over the values:
curl -X POST https://www.nohire.co.za/search_api/ \
  -H 'company_name: $company_name' \
  -H 'contact_phone_number: $contact_phone_number' \
  -H 'id_number: $id_number' \
  -H 'id_number_type: $id_number_type' \
  -H 'session_token: $your_session_key' \
  -H 'vehicle_registrastion_number: $vehicle_registrastion_number'

Calling the search using the url to carry over the values:
curl -X POST 'https://www.nohire.co.za/search_api/?session_token=$your_session_key&id_number=$id_number&id_number_type=$id_number_type&company_name=$company_name&contact_phone_number=$contact_phone_number&vehicle_registrastion_number=$vehicle_registrastion_number'
 
Search error code list:
1: The company name provided is to short.
2: Id number is invalid.
3: A empty search can not be completed.
4: The session token provided was invalid.
5: Invalid ID number type.

Notes: 
•	Login:
	>On Login Request 
	1. Check username/password/systemToken to validate login 
	2. Remember IP as part of session (may be even embed as part of token)
	3. If non-existing session or previous session expired, then don't need to check IP
	4. If existing session (non-expired) then also check if new IP address match current session IP. Accept login request but log and report error/warning if request is from differenet IP
		
•	Search Response:
	>"tickets" field will only be populated with 0 or more for "match":"exact" else set to -1 (invalid),
	>"equipmentReturned" and  "contactDetailsToReferClientToResolveTickets will only be populated for "tickets" > 0
-->